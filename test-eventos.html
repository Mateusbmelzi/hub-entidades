<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Eventos</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Teste de Conexão com Eventos</h1>
    <div id="results"></div>

    <script>
        const SUPABASE_URL = "https://lddtackcnpzdswndqgfs.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxkZHRhY2tjbnB6ZHN3bmRxZ2ZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEzOTY5MDgsImV4cCI6MjA2Njk3MjkwOH0.NPN6E-4RttputzXcVavoOTRGiM9c3T5bLaLPTtJJM4s";

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function testEventos() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testando conexão...</p>';

            try {
                // Teste 1: Verificar se a tabela eventos existe
                console.log('Teste 1: Verificando tabela eventos');
                const { data: eventos, error: error1 } = await supabase
                    .from('eventos')
                    .select('*')
                    .limit(5);

                if (error1) {
                    resultsDiv.innerHTML += `<p style="color: red;">Erro ao acessar tabela eventos: ${error1.message}</p>`;
                    console.error('Erro 1:', error1);
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✓ Tabela eventos acessível. Encontrados ${eventos.length} eventos</p>`;
                    console.log('Eventos encontrados:', eventos);
                }

                // Teste 2: Verificar eventos aprovados
                console.log('Teste 2: Verificando eventos aprovados');
                const { data: eventosAprovados, error: error2 } = await supabase
                    .from('eventos')
                    .select('*')
                    .eq('status_aprovacao', 'aprovado')
                    .limit(5);

                if (error2) {
                    resultsDiv.innerHTML += `<p style="color: red;">Erro ao buscar eventos aprovados: ${error2.message}</p>`;
                    console.error('Erro 2:', error2);
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✓ Eventos aprovados encontrados: ${eventosAprovados.length}</p>`;
                    console.log('Eventos aprovados:', eventosAprovados);
                }

                // Teste 3: Verificar JOIN com entidades
                console.log('Teste 3: Verificando JOIN com entidades');
                const { data: eventosComEntidades, error: error3 } = await supabase
                    .from('eventos')
                    .select(`
                        *,
                        entidades(id, nome)
                    `)
                    .eq('status_aprovacao', 'aprovado')
                    .limit(5);

                if (error3) {
                    resultsDiv.innerHTML += `<p style="color: red;">Erro ao fazer JOIN com entidades: ${error3.message}</p>`;
                    console.error('Erro 3:', error3);
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✓ JOIN com entidades funcionando. Encontrados ${eventosComEntidades.length} eventos</p>`;
                    console.log('Eventos com entidades:', eventosComEntidades);
                }

                // Teste 4: Verificar se há eventos na tabela
                const { count, error: error4 } = await supabase
                    .from('eventos')
                    .select('*', { count: 'exact', head: true });

                if (error4) {
                    resultsDiv.innerHTML += `<p style="color: red;">Erro ao contar eventos: ${error4.message}</p>`;
                    console.error('Erro 4:', error4);
                } else {
                    resultsDiv.innerHTML += `<p style="color: green;">✓ Total de eventos na tabela: ${count}</p>`;
                }

                // Teste 5: Verificar estrutura da tabela
                const { data: estrutura, error: error5 } = await supabase
                    .from('eventos')
                    .select('*')
                    .limit(1);

                if (error5) {
                    resultsDiv.innerHTML += `<p style="color: red;">Erro ao verificar estrutura: ${error5.message}</p>`;
                    console.error('Erro 5:', error5);
                } else if (estrutura && estrutura.length > 0) {
                    resultsDiv.innerHTML += `<p style="color: green;">✓ Estrutura da tabela verificada. Campos disponíveis: ${Object.keys(estrutura[0]).join(', ')}</p>`;
                    console.log('Estrutura:', estrutura[0]);
                }

            } catch (error) {
                resultsDiv.innerHTML += `<p style="color: red;">Erro geral: ${error.message}</p>`;
                console.error('Erro geral:', error);
            }
        }

        // Executar teste quando a página carregar
        window.addEventListener('load', testEventos);
    </script>
</body>
</html> 