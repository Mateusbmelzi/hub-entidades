<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Corre√ß√£o do Timezone</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .input-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .error { background: #ffebee; color: #c62828; }
        .debug-info { background: #e3f2fd; color: #1565c0; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste - Corre√ß√£o do Timezone</h1>
        
        <div class="section">
            <h2>Teste de Convers√£o de Data</h2>
            <div class="input-group">
                <label>Data/Hora para Testar (datetime-local):</label>
                <input type="datetime-local" id="dataTeste" value="2024-02-06T15:30">
            </div>
            <button onclick="testarConversao()">Testar Convers√£o</button>
            <div id="resultado" class="result"></div>
        </div>

        <div class="section">
            <h2>Informa√ß√µes do Sistema</h2>
            <div id="infoSistema" class="result"></div>
        </div>
    </div>

    <script>
        // Fun√ß√£o que simula exatamente o que est√° no hook
        function processarData(dataEvento) {
            // Criar uma data a partir do input datetime-local
            const dataLocal = new Date(dataEvento);
            
            // Verificar se a data √© v√°lida
            if (isNaN(dataLocal.getTime())) {
                throw new Error('Data inv√°lida fornecida');
            }
            
            // Obter o offset do timezone local
            const offset = dataLocal.getTimezoneOffset();
            const offsetHours = Math.abs(Math.floor(offset / 60));
            const offsetMinutes = Math.abs(offset % 60);
            
            // Construir o offset string (getTimezoneOffset() retorna minutos, positivo para timezones a oeste de UTC)
            const offsetString = `${offset >= 0 ? '-' : '+'}${String(offsetHours).padStart(2, '0')}:${String(offsetMinutes).padStart(2, '0')}`;
            
            // Garantir que temos segundos se n√£o estiverem presentes
            const dataString = dataEvento;
            const dataComSegundos = dataString.length === 16 ? dataString + ':00' : dataString;
            
            // Adicionar o timezone local √† data
            const dataEventoProcessada = dataComSegundos + offsetString;
            
            return {
                input: dataEvento,
                dataLocal: dataLocal.toString(),
                offset,
                offsetHours,
                offsetMinutes,
                offsetString,
                dataComSegundos,
                final: dataEventoProcessada
            };
        }

        function testarConversao() {
            const dataTeste = document.getElementById('dataTeste').value;
            
            if (!dataTeste) {
                mostrarResultado('Selecione uma data/hora', 'error');
                return;
            }

            try {
                const resultado = processarData(dataTeste);
                
                let html = `
                    <h3>Resultado da Convers√£o:</h3>
                    <div class="debug-info">
                        <strong>Input Original:</strong> ${resultado.input}<br>
                        <strong>Date Object:</strong> ${resultado.dataLocal}<br>
                        <strong>Timezone Offset (minutos):</strong> ${resultado.offset}<br>
                        <strong>Offset Horas:</strong> ${resultado.offsetHours}<br>
                        <strong>Offset Minutos:</strong> ${resultado.offsetMinutes}<br>
                        <strong>Offset String:</strong> ${resultado.offsetString}<br>
                        <strong>Data com Segundos:</strong> ${resultado.dataComSegundos}<br>
                        <strong>Resultado Final:</strong> ${resultado.final}<br>
                    </div>
                `;

                // Testar diferentes cen√°rios
                const cenarios = [
                    '2024-02-06T15:30',
                    '2024-02-06T00:00',
                    '2024-02-06T23:59'
                ];

                html += '<h3>Teste de Cen√°rios:</h3>';
                cenarios.forEach(cenario => {
                    try {
                        const res = processarData(cenario);
                        html += `
                            <div class="debug-info">
                                <strong>${cenario}</strong> ‚Üí <strong>${res.final}</strong>
                            </div>
                        `;
                    } catch (error) {
                        html += `
                            <div class="error">
                                <strong>${cenario}</strong> ‚Üí Erro: ${error.message}
                            </div>
                        `;
                    }
                });

                mostrarResultado(html, 'success');
            } catch (error) {
                mostrarResultado('Erro na convers√£o: ' + error.message, 'error');
            }
        }

        function mostrarInfoSistema() {
            const now = new Date();
            const offset = now.getTimezoneOffset();
            const offsetHours = Math.abs(Math.floor(offset / 60));
            const offsetMinutes = Math.abs(offset % 60);
            const offsetString = `${offset >= 0 ? '-' : '+'}${String(offsetHours).padStart(2, '0')}:${String(offsetMinutes).padStart(2, '0')}`;
            
            let html = `
                <h3>Informa√ß√µes do Sistema:</h3>
                <div class="debug-info">
                    <strong>Data/Hora Atual:</strong> ${now.toString()}<br>
                    <strong>Timezone Offset (minutos):</strong> ${offset}<br>
                    <strong>Offset Horas:</strong> ${offsetHours}<br>
                    <strong>Offset Minutos:</strong> ${offsetMinutes}<br>
                    <strong>Offset String:</strong> ${offsetString}<br>
                    <strong>Timezone Name:</strong> ${Intl.DateTimeFormat().resolvedOptions().timeZone}<br>
                    <strong>Locale:</strong> ${navigator.language}<br>
                </div>
            `;

            document.getElementById('infoSistema').innerHTML = html;
        }

        function mostrarResultado(mensagem, tipo) {
            const element = document.getElementById('resultado');
            element.innerHTML = mensagem;
            element.className = 'result ' + tipo;
        }

        // Carregar informa√ß√µes do sistema ao carregar a p√°gina
        window.onload = function() {
            mostrarInfoSistema();
        };
    </script>
</body>
</html> 